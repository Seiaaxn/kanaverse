generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model Bookmark {
  id        String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId    String
  type      String
  itemId    String
  title     String
  thumbnail String?
  createdAt DateTime @default(now())
  User      User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, type, itemId])
  @@index([userId])
}

model History {
  id            String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  userId        String
  type          String
  itemId        String
  title         String
  thumbnail     String?
  progress      String
  progressTitle String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  User          User     @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: NoAction)

  @@unique([userId, type, itemId])
  @@index([userId])
}

model User {
  id        String     @id @default(dbgenerated("(gen_random_uuid())::text"))
  clerkId   String     @unique
  email     String     @unique
  name      String?
  imageUrl  String?
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  Bookmark  Bookmark[]
  History   History[]
}

// ============= ANIME CACHE TABLE =============

model Anime {
  id               String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  urlId            String   @unique
  title            String
  alternativeTitle String?
  cover            String
  synopsis         String?  @db.Text
  status           String?
  type             String?
  totalEpisodes    Int?
  rating           Float?
  genres           Json?
  episodes         Json?
  lastEpisode      String?
  lastUpdate       String?
  sourceUrl        String?
  lastScraped      DateTime @default(now())
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  @@index([urlId])
  @@index([title])
  @@index([createdAt])
  @@index([lastScraped])
}

// ============= KOMIK CACHE TABLE =============

model Komik {
  id                  String   @id @default(dbgenerated("(gen_random_uuid())::text"))
  mangaId             String   @unique
  title               String
  alternativeTitle    String?
  coverImage          String
  coverPortrait       String?
  synopsis            String?  @db.Text
  status              Int?
  type                String?
  releaseYear         String?
  country             String?
  rating              Float?
  viewCount           BigInt?
  bookmarkCount       Int?
  genres              Json?
  authors             Json?
  artists             Json?
  latestChapterId     String?
  latestChapterNumber Float?
  latestChapterDate   DateTime?
  chapters            Json?
  sourceUrl           String?
  lastScraped         DateTime @default(now())
  createdAt           DateTime @default(now())
  updatedAt           DateTime @updatedAt

  @@index([mangaId])
  @@index([title])
  @@index([type])
  @@index([createdAt])
  @@index([lastScraped])
}

// ============= SYNC LOG TABLE =============

model SyncLog {
  id          String    @id @default(dbgenerated("(gen_random_uuid())::text"))
  type        String
  status      String
  itemsCount  Int       @default(0)
  errorMsg    String?   @db.Text
  startedAt   DateTime  @default(now())
  completedAt DateTime?
  duration    Int?

  @@index([type])
  @@index([startedAt])
}
